<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Agente Conversacional</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; background-color: #121212; color: #e0e0e0;}
        .chat-container { width: 90%; max-width: 600px; background-color: #1e1e1e; border-radius: 10px; padding: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.4); }
        h1 { text-align: center; color: #bb86fc; }
        form { display: flex; gap: 10px; }
        input[type="text"] { flex-grow: 1; padding: 12px; border: 1px solid #333; border-radius: 5px; background-color: #2c2c2c; color: #e0e0e0; font-size: 16px; }
        button { padding: 12px 20px; border: none; border-radius: 5px; background-color: #bb86fc; color: #121212; font-size: 16px; font-weight: bold; cursor: pointer; transition: background-color 0.2s; }
        button:hover { background-color: #a062f6; }
        #status { margin-top: 20px; text-align: center; color: #aaa; min-height: 24px; }
        audio { width: 100%; margin-top: 15px; }
    </style>
</head>
<body>
    <div class="chat-container">
        <h1>Agente Híbrido</h1>
        <form id="chat-form">
            <input type="text" id="pregunta" name="pregunta" placeholder="Escribe tu pregunta aquí..." required autocomplete="off">
            <button type="submit">Enviar</button>
        </form>
        <div id="status"></div>
        <audio id="audio-playback" controls style="display:none;"></audio>
    </div>

    <script>
        const form = document.getElementById('chat-form');
        const statusDiv = document.getElementById('status');
        const audioPlayback = document.getElementById('audio-playback');

        form.addEventListener('submit', async (event) => {
            event.preventDefault(); 

            const formData = new FormData(form);
            const pregunta = formData.get('pregunta');
            
            if (!pregunta) return;

            statusDiv.textContent = 'Pensando...';
            audioPlayback.style.display = 'none';
            form.querySelector('button').disabled = true;

            try {
                const response = await fetch('/preguntar', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    const audioBlob = await response.blob();
                    const audioUrl = URL.createObjectURL(audioBlob);
                    audioPlayback.src = audioUrl;
                    audioPlayback.style.display = 'block';
                    audioPlayback.play();
                    statusDiv.textContent = 'Respondiendo...';
                } else {
                    statusDiv.textContent = 'Hubo un error al generar la respuesta.';
                }
            } catch (error) {
                console.error('Error:', error);
                statusDiv.textContent = 'Error de conexión con el servidor.';
            } finally {
                form.querySelector('button').disabled = false;
                form.reset(); 
            }
        });

        audioPlayback.onended = () => {
            statusDiv.textContent = '';
        };
    </script>
</body>
</html>